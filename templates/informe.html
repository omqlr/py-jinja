{% extends "base.html" %}

{% block titulo %}Informe de tareas{% endblock %}

{% block contenido %}

<h2>Filtros</h2>
<div class="filtros">
  <form method="get" action="/informe">
    <label>
      Estado:
      <select name="estado">
        <option value="" {% if not estado %}selected{% endif %}>(Todos)</option>
        <option value="pendiente" {% if estado == "pendiente" %}selected{% endif %}>Pendiente</option>
        <option value="en_curso" {% if estado == "en_curso" %}selected{% endif %}>En curso</option>
        <option value="completada" {% if estado == "completada" %}selected{% endif %}>Completada</option>
      </select>
    </label>

    <label>
      Prioridad minima:
      <input type="number" name="min_prioridad" min="0" max="5" value="{{ min_prioridad }}" />
    </label>

    <button type="submit">Aplicar filtros</button>
  </form>
</div>

<h2>Resumen</h2>
<ul>
  <li>Total de tareas: {{ resumen.total }}</li>
  <li>Tareas completadas: {{ resumen.completadas }}</li>
  <li>Porcentaje completadas: {{ resumen.porcentaje_completadas }} %</li>
</ul>

<h2>Detalle de tareas</h2>
<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Titulo</th>
      <th>Estado</th>
      <th>Prioridad</th>
      <th>Horas</th>
    </tr>
  </thead>
  <tbody>
    {% for tarea in tareas %}
    <tr>
      <td>{{ tarea.id if tarea.id is defined else tarea["id"] }}</td>
      <td>{{ tarea.titulo if tarea.titulo is defined else tarea["titulo"] }}</td>
      <td>{{ tarea.estado if tarea.estado is defined else tarea["estado"] }}</td>
      <td>{{ tarea.prioridad if tarea.prioridad is defined else tarea["prioridad"] }}</td>
      <td>{{ tarea.horas if tarea.horas is defined else tarea["horas"] }}</td>
    </tr>
    {% endfor %}
    {% if tareas|length == 0 %}
    <tr>
      <td colspan="5">No hay tareas que cumplan los filtros.</td>
    </tr>
    {% endif %}
  </tbody>
</table>

<h2>Grafico: numero de tareas por estado</h2>
<canvas id="grafico" width="800" height="300"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const labels = {{ labels | tojson }};
  const values = {{ values | tojson }};

  const ctx = document.getElementById("grafico").getContext("2d");
  new Chart(ctx, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [
        {
          label: "Numero de tareas",
          data: values,
        },
      ],
    },
  });
</script>

{% endblock %}
